---
title: "Multi Logistic Regression"
---

**Problem Definition**  
Use titanic-train.csv to create a logistic model 
Use titanic-test.csv and find out the survivors amongst the data 

**Data Location**   
https://www.kaggle.com/c/titanic/data

**Data Description**    
Variable Descriptions:    
survival        Survival (0 = No; 1 = Yes)    
pclass          Passenger Class (1 = 1st; 2 = 2nd; 3 = 3rd)    
name            Name    
sex             Sex    
age             Age   
sibsp           Number of Siblings/Spouses Aboard   
parch           Number of Parents/Children Aboard   
ticket          Ticket Number   
fare            Passenger Fare    
cabin           Cabin   
embarked        Port of Embarkation (C = Cherbourg; Q = Queenstown; S = Southampton)   

**Setup**    
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```   
```{r load_libs, echo=TRUE}
library(tidyr)
library(dplyr)
library(ggplot2)
library(corrgram)
library(gridExtra) 
library(Deducer)
library(caret)
```   

**Functions**   
```{r functions, include=FALSE}
detect_outliers <- function(inp, na.rm=TRUE) {
  i.qnt <- quantile(inp, probs=c(.25, .75), na.rm=na.rm)
  i.max <- 2.5 * IQR(inp, na.rm=na.rm)
  otp <- inp
  otp[inp < (i.qnt[1] - i.max)] <- NA
  otp[inp > (i.qnt[2] + i.max)] <- NA
  inp[is.na(otp)]
}

detect_na <- function(inp) {
  sum(is.na(inp))
}
```

**Dataset**      
```{r read_data, echo=T}
dfrModel <- read.csv("D:/Naveen/Data Science/Nuclei - Online/Datasets/R/R data/titanic-train.csv", header=T, stringsAsFactors=F)
head(dfrModel)
```   
_Observation_   
Mix of both Numeric & Non-numeric data is seen


**Drop Columns**    
Drop all unrequired / aplha (descriptive only)
```{r drop_cols, echo=TRUE}
dfrModel <- dplyr::select(dfrModel, -c(PassengerId, Name, Ticket, Fare, Cabin, Embarked))
head(dfrModel)
```   

**Change Sex Column**    
Change Sex Col male = 0 / female = 0 / transgender = -1
```{r sex_change, echo=TRUE}
dfrModel$Sex <- ifelse(dfrModel$Sex=="male",0,1)
head(dfrModel)
```     

**Missing Data**        
```{r missing_data, echo=T}
#sum(is.na(dfrModel$Age))
lapply(dfrModel, FUN=detect_na)
```     

**Impute Data**        
```{r impute_data, echo=T}
dfrModel$Age[is.na(dfrModel$Age)] <- round(mean(dfrModel$Age[!is.na(dfrModel$Age)]),digits=0)
dfrModel$Age <- as.integer(dfrModel$Age)
detect_na(dfrModel$Age)
#head(dfrModel)
```     
_Note_    
Can we think of more different ways, to impute data here. If yes, what?
If we improve the data imputation logic, will this make a difference in accuracy?

**Outliers Data**        
```{r get_outliers, echo=T}
detect_outliers(dfrModel$Age)
#lapply(dfrModel, FUN=detect_outliers)
```     
_Observation_    
...    

**Outliers Graph**        
```{r graph_outliers, echo=T}
# make by your self ... possible to use a function here?
ggplot <- ggplot(data = stack(dfrModel), aes(x = ind,y = values)) +
  geom_boxplot(outlier.colour = 'red')
ggplot
```     
_Observation_   
...     

**Correlation**   
```{r cortest, echo=TRUE}
vctCorr = numeric(0)
for (i in names(dfrModel)){
    cor.result <- cor(as.numeric(dfrModel$Survived), as.numeric(dfrModel[,i]))
    vctCorr <- c(vctCorr, cor.result)
}
dfrCorr <- vctCorr
names(dfrCorr) <- names(dfrModel)
dfrCorr
```
```{r corrgram, echo =T}
corrgram(dfrModel)

```

**Data For Visualization**   
```{r graph_data, echo=TRUE}   
dfrGraph <- gather(dfrModel, variable, value, -Survived)
head(dfrGraph)
```    


**Data Visualization**   
```{r show_graph, echo=TRUE}   
ggplot(dfrGraph) +
    geom_jitter(aes(value,Survived, colour=variable)) + 
    facet_wrap(~variable, scales="free_x") +
    labs(title="Relation Of Survived With Other Features")
```   
_Observation_   
...    

**Summary**  
```{r show_summary, echo=TRUE}
lapply(dfrModel, FUN=summary)
```   
_Observation_    
...    

**Find Best Multi Logistic Model**   
Choose the best logistic model by using step(). 
```{r step_model, echo=T}
stpModel=step(glm(data=dfrModel, formula=Survived~., family=binomial), trace=0, steps=100)
summary(stpModel)
```   
_Observation_   
Best results given by Survived ~ Sex + Pclass + Age + SibSp   

**Make Final Multi Linear Model**   
```{r make_model, echo=T}   
# make model
mgmModel <- glm(data=dfrModel, formula=Survived~Sex+Pclass+Age+SibSp, family=binomial(link="logit"))
# print summary
summary(mgmModel)
```   

**Confusion Matrix**    
```{r conf_matrix, echo=T}
prdVal <- predict(mgmModel, type='response')
prdBln <- ifelse(prdVal > 0.5, 1, 0)
cnfmtrx <- table(prd=prdBln, act=dfrModel$Survived)
confusionMatrix(cnfmtrx)
```    

**Regression Data**      
```{r plot_data, echo=T}    
dfrPlot <- mutate(dfrModel, PrdVal=prdVal, PSurvived=prdBln)
head(dfrPlot)
```    

**Regression Visulaization**    
```{r plot_regr, echo=T}    
#dfrPlot
ggplot(dfrPlot, aes(x=PrdVal, y=PSurvived))  + 
    geom_point(shape=19, colour="blue", fill="blue") +
    geom_smooth(method="gam", formula=y~s(log(x)), se=FALSE) +
    labs(title="Binomial Regression Curve") +
    labs(x="") +
    labs(y="")
```    

**ROC Visulaization**    
```{r roc_plot, echo=T}
#rocplot(logistic.model,diag=TRUE,pred.prob.labels=FALSE,prob.label.digits=3,AUC=TRUE)
rocplot(mgmModel)
```     

**Test Data**  
```{r test_data, echo=T}
dfrTests <- read.csv("D:/Naveen/Data Science/Nuclei - Online/Datasets/R/R data/titanic-check.csv", header=T, stringsAsFactors=F)
dfrTests$Sex <- ifelse(dfrTests$Sex=="male",0,1)
dfrTests <- dplyr::select(dfrTests, -c(Name,Cabin,Fare,Embarked,Ticket,Parch))
head(dfrTests)
```   
_Observation_   
Test Data successfully created.   

**Predict**   
```{r predict, echo=T}
resVal <- predict(mgmModel, dfrTests, type="response")
prdSur <- ifelse(resVal > 0.5, 1, 0)
prdSur <- as.factor(prdSur)
levels(prdSur) <- c("NotSurvived", "Survived")
dfrTests <- mutate(dfrTests, Result=resVal, Survived=prdSur)
dfrTests 
```   
